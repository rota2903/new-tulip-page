<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TULIP 1</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      line-height: 1.6;
    }
    h1, h2, h3 {
      color: #2c3e50;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 20px;
    }
    th {
      background-color: #34495e;
      color: white;
      padding: 8px;
    }
    td {
      padding: 8px;
      border: 1px solid #ddd;
      text-align: center;
    }
    .loading {
      color: #7f8c8d;
      font-style: italic;
    }
    .error {
      color: red;
      font-weight: bold;
    }
    #adminPanel {
      margin-top: 40px;
      padding: 15px;
      border: 1px solid #bdc3c7;
      border-radius: 8px;
      background-color: #f9f9f9;
    }
    input[type="password"] {
      padding: 10px;
      width: 200px;
      margin-right: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      padding: 10px 15px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #2980b9;
    }
    .booked {
      background-color: #3498db !important;
      color: white !important;
    }
    .available {
      background-color: #2ecc71;
      color: white;
    }
  </style>
</head>
<body>
  <h1>TULIP 1</h1>

  <!-- WhatsApp Booking Button -->
  <a href="https://wa.me/6011112231979?text=Hi, I'd like to book TULIP 1" 
     style="display:block;background:#25D366;color:white;text-align:center;padding:15px;
            margin:20px 0;border-radius:5px;text-decoration:none;font-size:18px;font-weight:bold;">
     üì± Book via WhatsApp
  </a>

  <!-- Image Gallery -->
  <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:20px 0;">
    <img src="img1.jpg" style="width:100%;border-radius:8px;" alt="Unit Image 1">
    <img src="img2.jpg" style="width:100%;border-radius:8px;" alt="Unit Image 2">
    <img src="img3.jpg" style="width:100%;border-radius:8px;" alt="Unit Image 3">
    <img src="img4.jpg" style="width:100%;border-radius:8px;" alt="Unit Image 4">
    <img src="img5.jpg" style="width:100%;border-radius:8px;" alt="Unit Image 5">
    <img src="img6.jpg" style="width:100%;border-radius:8px;" alt="Unit Image 6">
  </div>

  <h2>üìÖ Availability Calendar</h2>
  <div id="calendar" class="loading">Loading availability...</div>

  <!-- Admin Panel -->
  <div id="adminPanel">
    <h2>üîê Admin Login</h2>
    <input type="password" id="adminPass" placeholder="Enter Password" />
    <button onclick="checkPassword()">Login</button>
    <div id="adminContent" style="display:none;margin-top:20px;">
      <h3>‚úÖ Approved Bookings</h3>
      <div id="approvedList"></div>
      <p><button onclick="logout()">Logout</button></p>
    </div>
  </div>

<script>
const ADMIN_PASSWORD = "9TulipsCH";

// üîÅ CHANGE THIS: Use a publicly accessible JSON endpoint
const BIN_FILE = "https://api.jsonbin.io/v3/b/YOUR_PUBLIC_JSONBIN_ID_HERE/latest"; // ‚Üê Replace with your actual public bin ID

let isAdminMode = false;
let bookings = [];

async function loadBookings() {
  try {
    const res = await fetch(BIN_FILE, {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
        // Optional: Some bins require headers
        // 'X-Master-Key': 'your-key' // Only if private and secured
      }
    });

    if (!res.ok) throw new Error(`Failed to load: ${res.status}`);

    const data = await res.json();
    // Adjust based on JSONBin v3 response format: { record: [...] }
    bookings = Array.isArray(data.record) ? data.record : [];
  } catch (e) {
    console.error("Error loading bookings:", e);
    document.getElementById("calendar").innerHTML = 
      `<p class="error">‚ö†Ô∏è Calendar failed to load. Please try again later.</p>`;
    return;
  }
  renderCalendar();
}

function renderCalendar() {
  const calendar = document.getElementById("calendar");
  calendar.innerHTML = "";
  const today = new Date();
  const bookedDates = new Set(bookings.map(b => b.date));

  for (let m = 0; m < 3; m++) {
    const monthDate = new Date(today.getFullYear(), today.getMonth() + m, 1);
    const month = monthDate.getMonth();
    const year = monthDate.getFullYear();
    const days = new Date(year, month + 1, 0).getDate();
    const startDay = new Date(year, month, 1).getDay(); // 0=Sunday

    let table = `<table>
      <tr><th colspan="7">${monthDate.toLocaleString('default', { month: 'long' })} ${year}</th></tr>
      <tr><th>Su</th><th>Mo</th><th>Tu</th><th>We</th><th>Th</th><th>Fr</th><th>Sa</th></tr>
      <tr>`;

    // Empty cells before first day
    for (let i = 0; i < startDay; i++) {
      table += "<td></td>";
    }

    // Fill in the days
    for (let d = 1; d <= days; d++) {
      const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
      const isBooked = bookedDates.has(dateStr);

      const cellClass = isBooked ? "booked" : "available";
      table += `<td class="${cellClass}">${d}</td>`;

      if ((d + startDay) % 7 === 0) table += "</tr><tr>";
    }

    // Close last row
    while ((days + startDay) % 7 !== 0) {
      table += "<td></td>";
      startDay++;
    }
    table += "</tr></table>";
    calendar.innerHTML += table;
  }
}

function checkPassword() {
  const pass = document.getElementById("adminPass").value;
  if (pass === ADMIN_PASSWORD) {
    isAdminMode = true;
    document.getElementById("adminPass").style.display = "none";
    document.querySelector("#adminPanel button").style.display = "none";
    document.getElementById("adminContent").style.display = "block";
    loadApproved();
  } else {
    alert("‚ùå Wrong password");
  }
}

function logout() {
  isAdminMode = false;
  document.getElementById("adminPass").style.display = "block";
  document.getElementById("adminPass").value = "";
  document.querySelector("#adminPanel button").style.display = "inline-block";
  document.getElementById("adminContent").style.display = "none";
}

function loadApproved() {
  const list = document.getElementById("approvedList");
  if (bookings.length === 0) {
    list.innerHTML = "<p>No bookings yet.</p>";
  } else {
    list.innerHTML = bookings
      .map(b => `<p>üìÖ <strong>${b.date}</strong> - ${b.name || 'Guest'}</p>`)
      .join("");
  }
}

// Load on page start
window.onload = loadBookings;
</script>
</body>
</html>
